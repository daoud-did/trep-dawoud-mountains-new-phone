// TREP DAWOUD - Performance Monitoring & Optimization
// Minimal script for monitoring Core Web Vitals

(function(window) {
    'use strict';

    const Perf = {
        // Initialize performance tracking
        init() {
            if ('PerformanceObserver' in window) {
                this.observeCoreWebVitals();
            }
            
            this.logResourceMetrics();
            this.detectSlowNetwork();
        },

        // Observe Web Vitals
        observeCoreWebVitals() {
            // Largest Contentful Paint
            try {
                const lcpObserver = new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    const lastEntry = entries[entries.length - 1];
                    const lcp = lastEntry.renderTime || lastEntry.loadTime;
                    this.logMetric('LCP', lcp);
                });
                lcpObserver.observe({type: 'largest-contentful-paint', buffered: true});
            } catch(e) {}

            // Cumulative Layout Shift
            try {
                const clsObserver = new PerformanceObserver((list) => {
                    let cls = 0;
                    list.getEntries().forEach((entry) => {
                        if (!entry.hadRecentInput) {
                            cls += entry.value;
                        }
                    });
                    this.logMetric('CLS', cls);
                });
                clsObserver.observe({type: 'layout-shift', buffered: true});
            } catch(e) {}

            // First Input Delay
            try {
                const fidObserver = new PerformanceObserver((list) => {
                    list.getEntries().forEach((entry) => {
                        this.logMetric('FID', entry.processingDuration);
                    });
                });
                fidObserver.observe({type: 'first-input', buffered: true});
            } catch(e) {}
        },

        // Log metrics to console (can be sent to analytics)
        logMetric(name, value) {
            if (process.env.NODE_ENV === 'development') {
                console.log(`${name}: ${Math.round(value)}ms`);
            }
        },

        // Log resource metrics
        logResourceMetrics() {
            if ('PerformanceResourceTiming' in window) {
                window.addEventListener('load', () => {
                    const resources = performance.getEntriesByType('resource');
                    const total = resources.reduce((sum, r) => sum + r.duration, 0);
                    console.log(`Total Resource Time: ${Math.round(total)}ms`);
                });
            }
        },

        // Detect slow networks
        detectSlowNetwork() {
            if ('connection' in navigator) {
                const conn = navigator.connection;
                const effectiveType = conn.effectiveType;
                
                if (effectiveType === '2g' || effectiveType === 'slow-2g') {
                    document.body.classList.add('slow-connection');
                    // Disable animations on slow networks
                    document.documentElement.style.setProperty('--base-transition', '0s');
                }
            }
        }
    };

    // Start performance tracking
    if (document.readyState !== 'loading') {
        Perf.init();
    } else {
        document.addEventListener('DOMContentLoaded', () => Perf.init());
    }

    window.Perf = Perf;
})(window);
